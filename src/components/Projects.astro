---
import { Link2 } from '@lucide/astro';
import LinkButton from './LinkButton.astro';
import { TAGS, ADMIN_TOOLS, PROJECT_STATUS } from './TagsIcons.astro';
import Modal from './Modal.astro';
import ImageModal from './ImageModal.astro';

const PROJECTS = [
	{
		title: 'AgroTraz - Gestion de Fabricas',
		description: `Desarrollo de una plataforma de gesti贸n integral para f谩bricas, dise帽ada para optimizar la administraci贸n de recursos y procesos. La aplicaci贸n permite a los usuarios gestionar y controlar diversos aspectos de la producci贸n, incluyendo la planificaci贸n, seguimiento y an谩lisis de datos en tiempo real.\n
		La interfaz de usuario es intuitiva y f谩cil de usar, lo que facilita la navegaci贸n y el acceso a la informaci贸n cr铆tica. La plataforma incluye funcionalidades avanzadas como la generaci贸n de informes personalizados, la integraci贸n con sistemas externos y la capacidad de adaptarse a las necesidades espec铆ficas de cada f谩brica.\n
		Adem谩s, se implementaron medidas de seguridad robustas para proteger la informaci贸n sensible y garantizar la privacidad de los datos. La aplicaci贸n est谩 dise帽ada para ser escalable y flexible, permitiendo a las f谩bricas crecer y adaptarse a los cambios en el mercado y en la tecnolog铆a.`,
		link: 'https://www.agrotraz.com/',
		image: ['/projects/gesfap.webp'],
		tags: [TAGS.TYPESCRIPT, TAGS.ASTRO, TAGS.REACT, TAGS.TAILWIND, TAGS.DOCKER, TAGS.MARIADB],
		status: PROJECT_STATUS.IN_PROGRESS,
		adminTool: ADMIN_TOOLS.VPS
	},
	{
		title: 'Goblin Ajedrez - Juego de ajedrez online',
		description: `GoblinAjedrez es un proyecto en el que he trabajado en la optimizaci贸n y mejora integral de su estructura y funcionalidad. He reescrito la mayor铆a de los archivos, optimiz谩ndolos y definiendo correctamente cada funci贸n, constante y par谩metro para mejorar la legibilidad y el mantenimiento del c贸digo. Adem谩s, he realizado una optimizaci贸n del SEO y la mejora de los metadatos para incrementar la visibilidad en buscadores.\n
		El logo original en formato PNG fue convertido a SVG para garantizar su correcta visualizaci贸n en distintos tama帽os y dispositivos. En t茅rminos de dise帽o, implement茅 Bootstrap para mejorar la est茅tica y mantener una experiencia de usuario coherente con la estructura previa del proyecto, basado en Python, archivos .py, templates y archivos est谩ticos. Tambi茅n realic茅 una reorganizaci贸n de la estructura de carpetas internas para optimizar la gesti贸n de los archivos.\n
		La secci贸n de puzzles ha sido completamente redise帽ada e implementada desde cero, incluyendo tres modos de juego distintos: puzzles de tres vidas, puzzles de tres minutos y puzzles por temas. Estos 煤ltimos cuentan con una amplia gama de ejercicios dise帽ados para el entrenamiento, organizados en diferentes tipos, apartados y subcategor铆as. Tambi茅n se han incorporado puzzles por rating, permitiendo una experiencia m谩s personalizada seg煤n el nivel del usuario. Todo el sistema ha sido reescrito con la integraci贸n de Chessground, proporcionando un tablero m谩s avanzado que permite modificar tanto el fondo como las piezas, con m谩s de veinte opciones distintas para cada uno. Adem谩s, este nuevo tablero es completamente redimensionable y ha mejorado significativamente la experiencia en dispositivos m贸viles, eliminando errores previos como bloqueos o fallos en la interacci贸n t谩ctil. Tambi茅n se ha a帽adido soporte para el clic secundario, permitiendo la creaci贸n de c铆rculos, flechas y diferentes estados antes de realizar un movimiento.\n
		Junto con estas mejoras, correg铆 errores en enlaces y rutas, asegurando una navegaci贸n m谩s intuitiva. Implement茅 ajustes en la estructura de los cursos, optimizando su accesibilidad y funcionalidad. El dise帽o fue adaptado para ser completamente responsivo, garantizando una experiencia 贸ptima en dispositivos m贸viles y tablets. Se a帽adi贸 la posibilidad de alternar entre un modo oscuro y un modo claro para mejorar la accesibilidad y personalizaci贸n del entorno. Tambi茅n implement茅 un sistema de autenticaci贸n que incluye registro y login mediante correo y contrase帽a, con notificaciones enviadas al correo electr贸nico para mayor seguridad.\n
		Con todas estas mejoras, GoblinAjedrez es ahora una plataforma m谩s eficiente, r谩pida y accesible, proporcionando una mejor experiencia tanto para jugadores como para estudiantes de ajedrez.`,
		link: 'https://goblinajedrez.com/',
		image: ['/projects/goblinajedrez.webp', '/projects/goblinajedrez-1.webp', '/projects/goblinajedrez.webp'],
		tags: [TAGS.PYTHON, TAGS.JINJA2, TAGS.HTML, TAGS.BOOTSTRAP, TAGS.SQLITE],
		status: PROJECT_STATUS.IN_PROGRESS,
		adminTool: ADMIN_TOOLS.VPS,
		history: [
			{
				date: '2024-01-15',
				tags: [TAGS.PYTHON, TAGS.JINJA2, TAGS.HTML, TAGS.BOOTSTRAP, TAGS.SQLITE],
				description: 'Versi贸n inicial con Python y Flask'
			},
			{
				date: '2025-12-10',
				tags: [TAGS.REACT, TAGS.TYPESCRIPT, TAGS.TAILWIND, TAGS.VITE, TAGS.NODE, TAGS.EXPRESS, TAGS.MARIADB],
				description: 'Migraci贸n completa a React y TypeScript con backend en Express'
			}
		]
	},
	{
		title: 'CMS - Incantatem',
		description: `Creaci贸n de un CMS personalizado enfocado en la gesti贸n eficiente de archivos e im谩genes. Este sistema permite a los administradores subir, editar y organizar archivos multimedia, generando metadatos en formato JSON que vinculan cada elemento con su informaci贸n correspondiente.\n
		El CMS cuenta con dos vistas: una para usuarios no t茅cnicos que facilita la visualizaci贸n y modificaci贸n de datos sin necesidad de interactuar con JSON, y otra avanzada para usuarios t茅cnicos que permite editar el JSON directamente. Adem谩s, se implement贸 una funcionalidad en tiempo real utilizando WebSocket, lo que permite monitorear y visualizar cambios en el stock de los elementos.\n
		Este proyecto no solo optimiza la gesti贸n de contenido, sino que tambi茅n integra caracter铆sticas avanzadas para adaptarse a las necesidades espec铆ficas de la tienda.`,
		link: '',
		image: ['/projects/custom_cms.webp'],
		tags: [TAGS.TYPESCRIPT, TAGS.NODE, TAGS.REACT, TAGS.TAILWIND, TAGS.DOCKER],
		status: PROJECT_STATUS.COMPLETED,
		adminTool: ADMIN_TOOLS.VPS
	},
	{
		title: 'ESP CUSTOMS LLC',
		description:
			'Responsable de la creaci贸n y desarrollo integral de la plataforma. Dise帽茅 y desarroll茅 desde cero tanto el servidor como el panel web, implementando una base de datos robusta, integraci贸n de APIs internas/externas y un sistema de eventos para la comunicaci贸n y componentizaci贸n del proyecto. Mejor茅 la eficiencia del sistema, implement茅 pruebas exhaustivas y una gesti贸n continua, logrando un despliegue eficiente y un soporte eficaz.',
		link: 'https://espcustoms.xyz',
		image: ['/projects/espcustoms.webp'],
		tags: [TAGS.TYPESCRIPT, TAGS.NODE, TAGS.ANGULAR, TAGS.BOOTSTRAP, TAGS.MONGODB],
		status: PROJECT_STATUS.COMPLETED,
		adminTool: ADMIN_TOOLS.CLOUD
	},
	{
		title: 'AuraFut - Ecommerce',
		description: `Desarrollo de una tienda online de productos deportivos estructurada en tres m贸dulos principales. Cada componente ha sido optimizado para ofrecer una experiencia de usuario r谩pida y eficiente, asegurando un rendimiento 贸ptimo de la plataforma.\n
		Admin: Panel de administraci贸n (admin.aurafut.com) para gestionar estad铆sticas, productos, pedidos y usuarios, con opciones de dise帽o personalizables. Incluye un sistema avanzado de subida de im谩genes que transcodifica a base64 con optimizaci贸n previa.\n
		Cliente: Plataforma de compra (aurafut.com), con funcionalidades como registro y login de usuarios, perfiles personales, gesti贸n de pedidos, y un sistema avanzado de compra que incluye diversas pasarelas de pago (Paypal, Mastercard, Visa, Google Pay). Tambi茅n cuenta con un buscador avanzado de productos, filtros personalizables y una interfaz intuitiva para mejorar la experiencia del usuario.\n
		Server: Servidor manejado a trav茅s de API, construido con Express, que incorpora sistemas de seguridad Middleware y autenticaci贸n de tokens, garantizando un entorno seguro y eficiente para la gesti贸n de datos y transacciones.`,
		link: 'https://aurafut.com',
		image: ['/projects/aurafut.webp'],
		tags: [TAGS.TYPESCRIPT, TAGS.NODE, TAGS.REACT, TAGS.BOOTSTRAP, TAGS.MONGODB],
		status: PROJECT_STATUS.COMPLETED,
		adminTool: ADMIN_TOOLS.SHOPIFY
	},
	{
		title: 'Canvacard - NPM',
		description: `Paquete NPM que permite a los desarrolladores crear tarjetas personalizadas de forma sencilla y r谩pida. Canvacard ofrece una amplia gama de plantillas predefinidas y personalizables, as铆 como la posibilidad de crear tarjetas desde cero. Los usuarios pueden a帽adir texto, im谩genes, iconos y formas, y personalizar el dise帽o con colores y fuentes personalizadas.\n
		Este proyecto ha sido desarrollado con JavaScript, @napi-rs/canvas, @skyra/gifenc y con TypeScript para realizar los tipados e interfaces . Canvacard es una herramienta vers谩til y eficiente que permite a los desarrolladores crear tarjetas personalizadas de forma r谩pida y sencilla.`,
		link: 'https://canvacard.srgobi.com/',
		image: ['/projects/canvacard.webp'],
		tags: [TAGS.JAVASCRIPT, TAGS.TYPESCRIPT],
		status: PROJECT_STATUS.COMPLETED,
		adminTool: ADMIN_TOOLS.VERCEL
	},
	{
		title: 'App Discord Peereira7',
		description: 'Creaci贸n y gesti贸n de una aplicaci贸n de Discord con m谩s de 50 comandos y soporte completo para todos los eventos. Optimizaci贸n en la gesti贸n de usuarios y mensajes para mejorar la experiencia en el servidor.',
		link: 'https://discord.gg/peereira7',
		image: ['/projects/Servidor_Peereira7.webp'],
		tags: [TAGS.TYPESCRIPT, TAGS.NODE, TAGS.DISCORD, TAGS.MONGODB],
		status: PROJECT_STATUS.COMPLETED,
		adminTool: ADMIN_TOOLS.VPS
	},
	{
		title: 'LibertadCripto - ComuniDAO',
		description: 'Plataforma para aprender sobre dinero, cripto y web3 con el contenido que se cre贸. Se puede acceder a la plataforma a trav茅s de Discord y la web. Se cre贸 un bot para el servidor de Discord que permite a los usuarios interactuar con la plataforma y obtener mucho aprendizaje. Los usuarios pueden aprender entre si en la plataforma.',
		link: 'https://www.instagram.com/libertadcripto',
		image: ['/projects/Servidor_LibertadCripto.webp'],
		tags: [TAGS.TYPESCRIPT, TAGS.NODE, TAGS.DISCORD, TAGS.MONGODB],
		status: PROJECT_STATUS.COMPLETED,
		adminTool: ADMIN_TOOLS.VPS
	},
	{
		title: 'ETTG',
		description: `El European Think Tanks Group (ETTG) es una red de seis think tanks europeos independientes que colaboran para proporcionar investigaci贸n y an谩lisis innovadores y relevantes para las pol铆ticas relacionadas con la cooperaci贸n internacional de la Uni贸n Europea y el desarrollo sostenible global.`,
		link: 'https://ettg.eu/',
		image: ['/projects/ettg.webp'],
		tags: [],
		status: PROJECT_STATUS.IN_PROGRESS,
		adminTool: ADMIN_TOOLS.WORDPRESS,
		bgColor: '#089C80'
	}
];
---

<div class="flex flex-col gap-y-16">
	{
		PROJECTS.map(({ image, title, description, tags, link, status, adminTool, history, bgColor }) => (
			<article class="flex flex-col space-x-0 space-y-8 group md:flex-row md:space-x-8 md:space-y-0">
				<div class="w-full md:w-1/2">
					<div class="relative flex flex-col items-center col-span-6 row-span-5 gap-8 transition duration-500 ease-in-out transform shadow-xl overflow-clip rounded-xl sm:rounded-xl md:group-hover:-translate-y-1 md:group-hover:shadow-2xl lg:border lg:border-zinc-800 lg:hover:border-zinc-700 lg:hover:bg-zinc-800/50">
						<label for={`image-modal-toggle-${title}`} class={`cursor-pointer w-full${bgColor ? ' aspect-video flex items-center justify-center' : ''}`} style={bgColor ? `background-color: ${bgColor}` : ''}>
							<img alt={title} class={`transition duration-500 ${bgColor ? 'object-contain max-h-full p-6 md:scale-100 md:group-hover:scale-105' : 'object-cover object-top w-full h-full sm:h-full md:scale-110 md:group-hover:scale-105'}`} loading="lazy" src={image[0]} />
						</label>
					</div>
				</div>

				<div class="w-full md:w-1/2 md:max-w-lg">
					<div class="flex items-start justify-between gap-2">
						<h3 class="text-2xl font-bold text-zinc-800 dark:text-zinc-100">{title}</h3>
						<span class={`flex gap-x-1 items-center rounded-full text-xs ${status.class} py-1 px-2 whitespace-nowrap`}>
							<status.icon class="size-3" />
							{status.name}
						</span>
					</div>
					<div class="flex flex-wrap mt-2">
						{tags && tags.length > 0 && (
							<div class="w-full mb-2">
								<p class="text-xs text-zinc-600 dark:text-zinc-500 mb-1">Tecnolog铆as:</p>
								<ul class="flex xl:flex-row flex-wrap gap-2">
									{tags.map((tag) => (
										<li>
											<span class={`flex gap-x-2 rounded-full text-xs ${tag.class} py-1 px-2 `}>
												<tag.icon class="size-4" />
												{tag.name}
											</span>
										</li>
									))}
								</ul>
							</div>
						)}
						{adminTool && (
							<div class="w-full mb-2">
								<p class="text-xs text-zinc-600 dark:text-zinc-500 mb-1">Administraci贸n:</p>
								<span class={`inline-flex gap-x-2 rounded-full text-xs ${adminTool.class} py-1 px-2`}>
									<adminTool.icon class="size-4" />
									{adminTool.name}
								</span>
							</div>
						)}
						{history && history.length > 0 && (
							<div class="w-full mb-2">
								<label for={`history-modal-toggle-${title}`} class="inline-flex items-center gap-2 text-xs text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200 cursor-pointer transition">
									 Ver hist贸rico de cambios ({history.length})
								</label>
							</div>
						)}
						<div class="mt-2 text-zinc-700 dark:text-zinc-400">
							{description.length > 200 ? (
								<>
									{/* Mostramos los primeros 200 caracteres */}
									<p>{description.slice(0, 200)}...</p>
									{/* Bot贸n para ver la descripci贸n completa */}
									<label for={`modal-toggle-${title}`} class="flex items-center gap-2 group-hover:underline decoration-zinc-500 decoration-dotted underline-offset-4 cursor-pointer">
										Ver m谩s detalles
										<svg width="13" height="13" stroke="currentColor" stroke-width="2" class="lucide-icon lucide lucide-arrow-up-right opacity-50 duration-200 group-hover:translate-x-[1.5px] group-hover:opacity-100" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
											<path d="M7 7h10v10" />
											<path d="M7 17 17 7" />
										</svg>
									</label>
									{/* Modal para la imagen ampliada */}
									<ImageModal id={`image-modal-toggle-${title}`} imageSrc={image[0]} imageAlt={`Imagen ampliada de ${title}`} />

									{/* Modal para la descripci贸n completa */}
									<Modal id={`modal-toggle-${title}`} title={`Detalles de ${title}`} showFooter={true}>
										<p style={{ whiteSpace: 'pre-line' }}>{description}</p>
									</Modal>
								</>
							) : (
								<p style={{ whiteSpace: 'pre-line' }}>{description}</p>
							)}
						</div>
						{history && history.length > 0 && (
							<Modal id={`history-modal-toggle-${title}`} title={` Hist贸rico de Cambios - ${title}`} maxWidth="3xl" showFooter={true}>
								<div class="space-y-4">
									{history.map((entry, index) => (
										<div class="border dark:border-white/10 border-zinc-300 rounded-lg p-4">
											<div class="flex items-center justify-between mb-3">
												<span class="text-sm font-semibold text-zinc-800 dark:text-zinc-200">{index === 0 ? ' Versi贸n Inicial' : ` Actualizaci贸n ${index}`}</span>
												<span class="text-xs text-zinc-600 dark:text-zinc-400">{entry.date}</span>
											</div>
											<p class="text-sm text-zinc-700 dark:text-zinc-300 mb-3">{entry.description}</p>
											<div class="flex flex-wrap gap-2">
												{entry.tags.map((tag) => (
													<span class={`flex gap-x-2 rounded-full text-xs ${tag.class} py-1 px-2`}>
														<tag.icon class="size-4" />
														{tag.name}
													</span>
												))}
											</div>
										</div>
									))}
								</div>
							</Modal>
						)}
						<footer class="flex gap-x-4 items-end justify-start mt-4">
							{link ? (
								<LinkButton href={link}>
									<Link2 class="size-4 mr-1" />
									Ir al sitio web
								</LinkButton>
							) : (
								<span class="inline-flex items-center gap-x-2 rounded-full text-xs bg-zinc-800 text-zinc-400 py-1 px-3 border border-zinc-700">
									<svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
										<path d="M7 11V7a5 5 0 0 1 10 0v4" />
									</svg>
									Enlace privado
								</span>
							)}
						</footer>
					</div>
				</div>
			</article>
		))
	}
</div>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		const modalIds = [
			'modal-toggle-AgroTraz - Gestion de Fabricas',
			'modal-toggle-Goblin Ajedrez - Juego de ajedrez online',
			'modal-toggle-CMS - Incantatem',
			'modal-toggle-ESP CUSTOMS LLC',
			'modal-toggle-AuraFut - Ecommerce',
			'modal-toggle-Canvacard - NPM',
			'modal-toggle-App Discord Peereira7',
			'modal-toggle-LibertadCripto - ComuniDAO',
			'image-modal-toggle-AgroTraz - Gestion de Fabricas',
			'image-modal-toggle-Goblin Ajedrez - Juego de ajedrez online',
			'image-modal-toggle-CMS - Incantatem',
			'image-modal-toggle-ESP CUSTOMS LLC',
			'image-modal-toggle-AuraFut - Ecommerce',
			'image-modal-toggle-Canvacard - NPM',
			'image-modal-toggle-App Discord Peereira7',
			'image-modal-toggle-LibertadCripto - ComuniDAO',
			'history-modal-toggle-Goblin Ajedrez - Juego de ajedrez online'
		];

		modalIds.forEach((id) => {
			const modal = document.getElementById(id);
			if (modal) {
				modal.addEventListener('change', () => {
					if ((modal as HTMLInputElement).checked) {
						document.body.classList.add('overflow-hidden');
					} else {
						document.body.classList.remove('overflow-hidden');
					}
				});
			}
		});
	});
</script>
