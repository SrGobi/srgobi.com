---
import ThemeToggle from './ThemeToggle.astro';
const navItems = [
	{
		title: 'Experiencia',
		label: 'experiencia',
		url: '/#experiencia',
		btnurl: "window.location='#experiencia'",
		svgHtml: `<svg {...Astro.props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 64 64" fill="currentColor"><path d="M 29 7 C 25.686 7 23 9.686 23 13 L 15 13 C 11.686 13 9 15.686 9 19 L 9 26.173828 C 11.661 26.749828 22.639 29 32 29 C 41.361 29 52.339 26.749828 55 26.173828 L 55 19 C 55 15.686 52.314 13 49 13 L 41 13 C 41 9.686 38.314 7 35 7 L 29 7 z M 29 11 L 35 11 C 36.104 11 37 11.895 37 13 L 27 13 C 27 11.895 27.896 11 29 11 z M 9 30.261719 L 9 45 C 9 48.314 11.686 51 15 51 L 49 51 C 52.314 51 55 48.314 55 45 L 55 30.261719 C 51.856 30.916719 43.863 32.448813 36 32.882812 L 36 33 C 36 34.105 35.104 35 34 35 L 29 35 C 27.896 35 27 34.105 27 33 L 27 32.822266 C 19.468 32.320266 12.011 30.888719 9 30.261719 z"></path></svg>`
	},
	{
		title: 'Proyectos',
		label: 'proyectos',
		url: '/#proyectos',
		btnurl: "window.location='#proyectos'",
		svgHtml: `<svg {...Astro.props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 8l-4 4l4 4"></path><path d="M17 8l4 4l-4 4"></path><path d="M14 4l-4 16"></path></svg>`
	},
	{
		title: 'Sobre m√≠',
		label: 'sobre-mi',
		url: '/#sobre-mi',
		btnurl: "window.location='#sobre-mi'",
		svgHtml: `<svg {...Astro.props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z"></path></svg>`
	},
	{
		title: 'Contacto',
		label: 'contacto',
		url: '/#',
		btnurl: "window.location='#'",
		svgHtml: `<svg {...Astro.props} xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 50 50" fill="currentColor"><path d="M 13 4 C 8.038 4 4 8.037 4 13 L 4 37 C 4 41.963 8.038 46 13 46 L 37 46 C 37.338 46 37.671 45.978406 38 45.941406 L 38 4.0585938 C 37.671 4.0215938 37.338 4 37 4 L 13 4 z M 40 4.5253906 L 40 14 L 46 14 L 46 13 C 46 9.09 43.49 5.7643906 40 4.5253906 z M 22 12 C 29.168 12 35 17.832 35 25 C 35 32.168 29.168 38 22 38 C 14.832 38 9 32.168 9 25 C 9 17.832 14.832 12 22 12 z M 22 14 C 15.935 14 11 18.935 11 25 C 11 27.814 12.071406 30.377219 13.816406 32.324219 C 15.889406 30.225219 18.852 29 22 29 C 25.14 29 28.1135 30.222312 30.1875 32.320312 C 31.9295 30.373313 33 27.812 33 25 C 33 18.935 28.065 14 22 14 z M 40 16 L 40 24 L 46 24 L 46 16 L 40 16 z M 22 18.5 C 24.481 18.5 26.5 20.519 26.5 23 C 26.5 25.481 24.481 27.5 22 27.5 C 19.519 27.5 17.5 25.481 17.5 23 C 17.5 20.519 19.519 18.5 22 18.5 z M 40 26 L 40 34 L 46 34 L 46 26 L 40 26 z M 40 36 L 40 45.474609 C 43.49 44.235609 46 40.91 46 37 L 46 36 L 40 36 z"></path></svg>`
	}
];
---

<header class="md:visible invisible fixed top-0 z-10 flex items-center justify-center w-full mx-auto mt-2">
	<nav
		class={`
      w-2/4 h-full
      rounded-full md:px-6 px-3
      flex flex-wrap flex-row items-center justify-center
      bg-neutral-200/70 dark:bg-black/50 backdrop-blur-2xl
    `}
	>
		{
			navItems.map((link) => (
				<a class="text-zinc-800 dark:text-zinc-100 hover:bg-white/10 p-1 rounded-full px-2 sm:px-3 transition ease-in text-sm sm:text-base capitalize" aria-label={link.label} href={link.url}>
					{link.title}
				</a>
			))
		}
		<ThemeToggle />
	</nav>
</header>

<div class="md:invisible visible fixed bottom-0 left-0 z-50 w-full h-16 border-t border-zinc-500 bg-neutral-200/70 dark:bg-black/50 backdrop-blur-2xl">
	<div class="grid h-full max-w-lg grid-cols-4 mx-auto font-medium">
		{
			navItems.map((link) => (
				<button type="button" class="inline-flex flex-col items-center justify-center border-zinc-200 border-x hover:bg-white/10 dark:hover:bg-zinc-800 group dark:border-zinc-600" onclick={link.btnurl}>
					<div class="group-hover:text-blue-600 dark:group-hover:text-blue-500" set:html={link.svgHtml} />
					<a class="text-sm text-zinc-500 dark:text-zinc-400 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-label={link.label} href={link.url}>
						{link.title}
					</a>
				</button>
			))
		}
	</div>
</div>

<script>
	document.addEventListener('astro:page-load', () => {
		const sections = document.querySelectorAll('section');
		const navItems = document.querySelectorAll('header nav a');

		const callback = (entries: any[]) => {
			entries.forEach((entry) => {
				if (entry.isIntersecting) {
					navItems.forEach((item) => {
						if (item.getAttribute('aria-label') == entry.target.id) {
							item.classList.add('text-blue-500');
						} else {
							item.classList.remove('text-blue-500');
						}
					});
				}
			});
		};

		const observer = new IntersectionObserver(callback, {
			root: null,
			rootMargin: '0px',
			threshold: 0.3
		});

		sections.forEach((section) => {
			observer.observe(section);
		});

		// Cleanup function
		document.onvisibilitychange = () => {
			if (document.visibilityState === 'hidden') {
				observer.disconnect();
			}
		};
	});
</script>

<style>
	nav {
		animation: nav-shadown 1s linear both;
		animation-timeline: scroll();
		animation-range: 0 400px;
	}
	@keyframes nav-shadown {
		to {
			box-shadow:
				0 10px 15px -3px rgba(0, 0, 0, 0.1),
				0 4px 6px -2px rgba(0, 0, 0, 0.05);
		}
	}
</style>
